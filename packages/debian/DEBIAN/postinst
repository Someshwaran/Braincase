#!/bin/bash

# Author:	Robert McLeod
# Date: 	23 August 2012
# Desc:		Post install script for Braincase

# Enable the user dirs

# TODO: replace this with plain commands in this file

#Setup Per-User-Directory
a2enmod userdir

# Make dokuwiki the root site
a2ensite doku
a2dissite default

# Enable SSL
a2enmod ssl

# Convenience link for dropbox
ln -s /usr/bin/dropbox.py /usr/bin/dropbox

# Need to make the cron script root only
chown root:root /etc/cron.d/braincase
chmod og-rwx /etc/cron.d/braincase

# Remove this configuration file that stuffs everything up
if [ -f /etc/apache2/conf.d/dokuwiki.conf ]; then
	unlink /etc/apache2/conf.d/dokuwiki.conf
fi;

# Link the logs in (and perm them)
for log in `ls /var/log/braincase`; do
  link="/var/lib/dokuwiki/data/pages/admin/logs/"`echo $log|cut -d'/' -f5|sed 's/\.log/\.txt/'`;
  ln -s $log $link;
  chgrp www-data $link;
  chmod 755 $link;
done;

# Reload apache
service apache2 reload