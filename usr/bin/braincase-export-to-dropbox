#!/usr/bin/ruby

# Author: Robert McLeod
# Desc:   Exports the backup zip file specified at the command line
#         to the dropbox folder

$LOAD_PATH.unshift(File.dirname("/usr/share/braincase/lib/braincase"))

require 'braincase/utils'

abort "Must be root" if !Braincase.is_root?

if ARGV[0].nil?
  puts "Usage: braincase-export-to-dropbox <filename>"
  exit
end

filepath = ARGV[0]
home = filepath.match(/\/home\/[^\/]+/)[0]
dropbox_dir = "#{home}/Dropbox/Braincase"

if !File.exists? filepath
  puts "Unable to export to dropbox couldn't find the file given (#{filepath})"
  exit
end

if !File.directory? dropbox_dir
  puts "Unable to export to dropbox couldn't find the dropbox folder (#{dropbox_dir})"
  exit
end

exec "ln -s #{filepath} #{dropbox_dir}/"